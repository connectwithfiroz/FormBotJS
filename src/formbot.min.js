/*!
 * FormBotJS v1.0.0
 * (c) 2025 Firoz Ansari ‚Äî All rights reserved
 * License: https://formbot.tutizo.com/formbot/license
 */
console.log("%cFormBotJS by Firoz Ansari","color:#0078ff;font-weight:bold;");const FormBot={config:{},current:0,answers:[],initHTML:'\n    <div id="chat-container" class="chat-box light-theme">\n    <div class="chat-header">\n        <h6 id="chat_formTitle">Chat Assistant</h6>\n        <div class="chat-actions">\n            <button id="restart-btn">Restart</button>\n            <button id="theme-toggle-btn">üåô</button>\n        </div>\n    </div>\n\n    <div id="chat-messages" class="chat-messages"></div>\n\n    <form id="chatInputSubmitForm" novalidate>\n        <div id="chat-input-area">\n            <div id="chat-input-wrapper"></div>\n            <button id="send-btn" type="submit">Send</button>\n        </div>\n    </form>\n</div>\n',init(e){if(this.config=e,!e.chat_containerId)return alert("‚ö†Ô∏è chat_containerId required in config");document.getElementById(e.chat_containerId).innerHTML=this.initHTML,document.getElementById("theme-toggle-btn").addEventListener("click",(function(){const e=document.getElementById("chat-container");e.classList.toggle("dark-theme"),e.classList.toggle("light-theme"),this.textContent=e.classList.contains("dark-theme")?"‚òÄÔ∏è":"üåô"})),document.getElementById("restart-btn").addEventListener("click",(e=>{this.answers=[],document.getElementById("chat-messages").innerHTML="",this.current=0,this.showBotMessage()})),this.aut="Rmlyb3ogQW5zYXJpICgrOTEgODc4OTcwMTkxNik=",this.current=0,this.answers=[],this.messagesEl=document.getElementById("chat-messages"),this.chatInputWrapper=document.getElementById("chat-input-wrapper"),this.formEl=document.getElementById("chatInputSubmitForm"),this.sendBtn=document.getElementById("send-btn"),this.chat_form_title=document.querySelector("#chat-container #chat_formTitle"),this.formEl.addEventListener("submit",(e=>{e.preventDefault(),this.handleSend()})),this.showBotMessage(),e.color1&&this.setChatColor(e.color1),this.chat_form_title.innerHTML=e.chat_form_title??"Chat assistant"},setChatColor(e){document.documentElement.style.setProperty("--chat_color1",e)},escapeHTML:e=>e.replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]))),showImagePreview(e,t){if(!document.getElementById("imagePopup")){const e=document.createElement("div");e.id="imagePopup",e.className="image-popup",e.innerHTML='\n      <img id="popupImage" src="" alt="">\n      <span class="close-btn">√ó</span>\n    ',document.body.appendChild(e),e.querySelector(".close-btn").addEventListener("click",(()=>this.closeImagePopup())),e.addEventListener("click",(t=>{t.target===e&&this.closeImagePopup()}))}const s=document.getElementById("imagePopup"),n=s.querySelector("#popupImage");n.src=e,n.alt=t,s.style.display="flex"},closeImagePopup(){const e=document.getElementById("imagePopup");e&&(e.style.display="none")},showMessage(e,t="bot"){const s=document.createElement("div");s.className=`chat-bubble ${t}`,s.innerHTML=e,this.messagesEl.appendChild(s),this.scrollToBottom()},showUserMessage(e){this.showMessage(e,"user")},scrollToBottom(){this.messagesEl.scrollTop=this.messagesEl.scrollHeight},showBotMessage(){for(var e=this.config.questions[this.current];e&&"hidden"==e.type;)this.answers.push({label:e.label,name:e.name||`q${this.current}`,value:e.attrs.value??""}),this.current++,e=this.config.questions[this.current];if(!e)return this.finish();let t;this.showMessage(e.label);const s=this.chatInputWrapper;if(s.innerHTML="",["text","email","number","date","file"].includes(e.type)?(t=document.createElement("input"),t.type=e.type):"textarea"===e.type?t=document.createElement("textarea"):"radio"===e.type&&e.options?(t=document.createElement("div"),e.options.forEach((e=>{const s=document.createElement("label");s.innerHTML=`<input type='radio' name='radio-${this.current}' value='${e}'> ${e}`,t.appendChild(s)}))):"select"===e.type&&e.options?(t=document.createElement("select"),e.options.forEach((e=>{const s=document.createElement("option");s.value=e,s.textContent=e,t.appendChild(s)}))):"multiselect"===e.type&&e.options?(t=document.createElement("select"),t.multiple=!0,e.options.forEach((e=>{const s=document.createElement("option");s.value=e,s.textContent=e,t.appendChild(s)}))):(t=document.createElement("input"),t.type="text"),e.attrs)for(const[s,n]of Object.entries(e.attrs))t.setAttribute(s,n);t.id="chat-input",s.appendChild(t),t.focus(),this.inputEl=t},handleSend(){const e=this.config.questions[this.current];if(!e)return;let t="";if("radio"===e.type){const e=document.querySelector(`input[name='radio-${this.current}']:checked`);if(!e)return alert("Please select an option.");t=e.value}else if("file"===e.type){const s=this.inputEl.files[0];if(!s)return alert("Please select a file.");if(e.attrs&&e.attrs["data-maxsize"]){const t=parseFloat(e.attrs["data-maxsize"]);if(s.size>1024*t*1024)return alert(`File must be smaller than ${t} MB.`)}const n=URL.createObjectURL(s);let i=document.createElement("div");if(i.className="chat-bubble user",s.type.startsWith("image/")){const e=document.createElement("a");e.href="#",e.textContent=`üì∑ ${s.name}`,e.className="file-link",e.addEventListener("click",(e=>{e.preventDefault(),this.showImagePreview(n,s.name)})),i.appendChild(e)}else{const e=document.createElement("a");e.href=n,e.target="_blank",e.textContent=`üìé ${s.name}`,e.className="file-link",i.appendChild(e)}t=i}else if("multiselect"===e.type){const e=Array.from(this.inputEl.selectedOptions).map((e=>e.value));if(0===e.length)return alert("Please select at least one option.");t=e.join(", ")}else if(t=this.inputEl.value.trim(),!this.inputEl.checkValidity())return void this.inputEl.reportValidity();"file"!=e.type?(t=this.escapeHTML(t),this.showUserMessage(t)):(this.messagesEl.appendChild(t),this.scrollToBottom()),this.answers.push({label:e.label,name:e.name||`q${this.current}`,value:t,file:null}),this.current++,setTimeout((()=>this.showBotMessage()),200)},async finish(){this.showMessage("Sending your responses...");let e=this.sendBtn.innerHTML;this.sendBtn.innerHTML="‚è≥ Sending...",this.sendBtn.disabled=!0;const t=new FormData;if(this.answers.forEach((e=>{e.file?t.append(e.name,e.file):t.append(e.name,e.value)})),this.config.extraData&&"object"==typeof this.config.extraData)for(const e in this.config.extraData)t.append(e,this.config.extraData[e]);if("submit"===this.config.mode)try{const e=await fetch(this.config.post_url,{method:"POST",body:t});let s="";try{const t=await e.json();t&&t.message&&(s=t.message)}catch(e){}e.ok?this.showMessage(s??"üéâ Submitted successfully!"):this.showMessage(s??"‚ö†Ô∏è Submission failed.")}catch(e){this.showMessage("‚ö†Ô∏è Network error.")}else"return"===this.config.mode&&this.showMessage("Responses collected successfully!");this.config.onComplete&&this.config.onComplete(this.answers,t),this.sendBtn.innerHTML=e,this.sendBtn.disabled=!1}};